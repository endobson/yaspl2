#:module (elf-file)
#:import {
  (aligned-bytes)
  (formats elf)
  (io)
  (list)
  (prim)
  (structured-native-code)
}
(export)
(types)

(define (main [args : (Array Bytes)] [stdin : InputPort] [stdout : OutputPort] [stderr : OutputPort]) : Int
  (case (array->list args)
    [(cons _ (cons output-file1 (cons output-file2 (empty))))
     (begin
       (call-with-output-file/void output-file1
         (lambda ([p : OutputPort]) : Void
           (write-all-bytes
             (serialize-elf-file
               (program-section (aligned-bytes #"" 0) (empty) (empty)))
             p)))
       (call-with-output-file/void output-file2
         (lambda ([p : OutputPort]) : Void
           (write-all-bytes
             (serialize-elf-file
               (program-section
                 (aligned-bytes #"\xC3\x90\xC3" 0)
                 (empty)
                 (varargs list
                   (defined-symbol #"fun1" 0)
                   (defined-symbol #"fun2" 1)
                   )))
             p)))
       0)]
    [_
      (begin
        (write-line #"Wrong number of args" stderr)
        1)]))
