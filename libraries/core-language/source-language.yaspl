#:module (core-language source-language)
#:import {
  (list)
  (module-name)
  (prim)
  (yaspl math-operations)
}
(export
  (#:types Module Definition Parameter Statement Expression
           PreType)
  (#:values module function-definition parameter
            var-pre-type array-pre-type pointer-pre-type
            return-statement if-statement
            define-local-variable-statement assignment-statement
            var-expr int-expr bin-op-expr cast-expr
            parameter-name)
  (#:patterns module function-definition parameter
              return-statement if-statement
              define-local-variable-statement assignment-statement
              var-expr int-expr bin-op-expr cast-expr))
(types
  (define-type Module
    (module [name : ModName]
            [definitions : (List Definition)]))

  (define-type Definition
    (function-definition
      [name : Bytes]
      [parameters : (List Parameter)]
      [statements : (List Statement)]))

  (define-type PreType
    (var-pre-type [var : Bytes])
    (array-pre-type [t : PreType])
    (pointer-pre-type [t : PreType]))

  (define-type Parameter
    (parameter [name : Bytes] [type : PreType]))

  (define-type Statement
    (return-statement [e : Expression])
    (define-local-variable-statement [v : Bytes] [type : PreType] [e : Expression])
    (assignment-statement [v : Bytes] [e : Expression])
    (if-statement
      [c : Expression]
      [t : (List Statement)]
      [f : (List Statement)]))

  (define-type Expression
    (var-expr [var : Bytes])
    (int-expr [v : Int])
    (bin-op-expr [op : BinOp] [l : Expression] [r : Expression])
    (cast-expr [t : PreType] [e : Expression])))
