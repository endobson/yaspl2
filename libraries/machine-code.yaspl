#:module (machine-code)
#:import {
  (prim)
}
(export
  (#:types SystemAbi MachineCodeOutputFormat)
  (#:values object-format assembly-format osx-abi linux-abi current-system-abi)
  (#:patterns object-format assembly-format osx-abi linux-abi))
(types
  (define-type SystemAbi
    (osx-abi)
    (linux-abi))

  (define-type MachineCodeOutputFormat
    (object-format [abi : SystemAbi])
    (assembly-format [abi : SystemAbi])))

(define (current-system-abi) : SystemAbi
  (case (current-system-abi-int)
    [1 (osx-abi)]
    [2 (linux-abi)]
    [_ (panic #"Unknown abi")]))
